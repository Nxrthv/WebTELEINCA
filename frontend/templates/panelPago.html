<!DOCTYPE html>
<html lang="es">

<head>
    <base href="/TeleIncaWebp/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="frontend/Css/panelPago.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>TELEINCA | Pagos</title>
</head>

<body style="background-color: #f8f9fa;">
    <!-- Nuevo Header -->
    <div class="container-fluid py-4" style="background: linear-gradient(135deg, #28a745 0%, #218838 100%);">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8 mx-auto text-center text-white">
                    <div class="mb-4">
                        <i class="bi bi-shield-check" style="font-size: 3rem;"></i>
                        <i class="bi bi-credit-card mx-3" style="font-size: 3rem;"></i>
                        <i class="bi bi-cash-coin" style="font-size: 3rem;"></i>
                    </div>
                    <h1 class="display-5 fw-bold mb-2">Centro de Pagos TELEINCA</h1>
                    <p class="lead opacity-90 mb-0">Realiza tus pagos de manera segura y rápida</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Métodos de Pago -->
    <div class="container mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <h4 class="text-center mb-4 mt-4">
                    <i class="bi bi-wallet2 me-2 p-4"></i>
                    Elige tu método de pago preferido
                </h4>
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <!-- Yape -->
                    <div class="col">
                        <div class="text-white rounded p-4 text-center m-1 h-100" style="background-color: #62167A;">
                            <p class="display-6">Pago por Yape:</p>
                            <img src="frontend/Resources/Images/pagos_icon/yape_qr.jpg" class="img-fluid">
                            <p>Escanee el codigo QR, realize el pago por el monto de: <p><strong>S/. <span id="monto-yape"></span></strong></p> Luego ingrese el numero de transaccion y procese el pago</p>
                            <div class="input-group">
                                <span class="input-group-text border-0"><i class="bi bi-wallet2"></i></span>
                                <input class="form-control border-0 input_field" placeholder="Número de transacción" type="text"
                                    name="nmr_process" id="nmr_process_yape" required>
                            </div>
                            <div onclick="procesarPagoYape()" id="nmr_process_yape" class="m-auto border-0 cont-btn mt-4">
                                <div class="left-side-yape">
                                    <div id="card">
                                        <div class="card-line-yape"></div>
                                        <div class="buttons"></div>
                                    </div>
                                    <div class="post">
                                        <div class="post-line"></div>
                                        <div class="screen">
                                            <div class="dollar">S/.</div>
                                        </div>
                                        <div class="numbers"></div>
                                        <div class="numbers-line2"></div>
                                    </div>
                                </div>
                                <div class="right-side">
                                    <div class="new border-0 text-black">Procesar</div>
                                    <svg viewBox="0 0 451.846 451.847" height="512" width="512" xmlns="http://www.w3.org/2000/svg"
                                        class="arrow">
                                        <path fill="#cfcfcf" data-old_color="#000000" class="active-path" data-original="#000000"
                                            d="M345.441 248.292L151.154 442.573c-12.359 12.365-32.397 12.365-44.75 0-12.354-12.354-12.354-32.391 0-44.744L278.318 225.92 106.409 54.017c-12.354-12.359-12.354-32.394 0-44.748 12.354-12.359 32.391-12.359 44.75 0l194.287 194.284c6.177 6.18 9.262 14.271 9.262 22.366 0 8.099-3.091 16.196-9.267 22.373z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BBVA -->
                    <div class="col">
                        <div class="text-white rounded p-4 text-center m-1 h-100" style="background-color: #072146;">
                            <p class="display-6">Pago con deposito a BBVA:</p>
                            <img src="frontend/Resources/Images/pagos_icon/BBVA.jpg" class="img-fluid">
                            <p>Realize el pago a nuestro numero de cuenta por el monto de <p><strong>S/. <span id="monto-bbva"></span></strong></p> Luego ingrese el numero de transaccion y procese el pago</p>
                            <div class="input-group">
                                <span class="input-group-text border-0"><i class="bi bi-wallet2"></i></span>
                                <input class="form-control border-0 input_field" placeholder="Número de transacción" type="text"
                                    name="nmr_process" id="nmr_process_bbva" required>
                            </div>
                            <div onclick="procesarPagoBbva()" id="container" class="m-auto border-0 mt-4 cont-btn">
                                <div class="left-side-bbva">
                                    <div id="card">
                                        <div class="card-line-bbva"></div>
                                        <div class="buttons"></div>
                                    </div>
                                    <div class="post">
                                        <div class="post-line"></div>
                                        <div class="screen">
                                            <div class="dollar">S/.</div>
                                        </div>
                                        <div class="numbers"></div>
                                        <div class="numbers-line2"></div>
                                    </div>
                                </div>
                                <div class="right-side">
                                    <div class="new border-0 text-black">Procesar</div>
                                    <svg viewBox="0 0 451.846 451.847" height="512" width="512" xmlns="http://www.w3.org/2000/svg"
                                        class="arrow">
                                        <path fill="#cfcfcf" data-old_color="#000000" class="active-path" data-original="#000000"
                                            d="M345.441 248.292L151.154 442.573c-12.359 12.365-32.397 12.365-44.75 0-12.354-12.354-12.354-32.391 0-44.744L278.318 225.92 106.409 54.017c-12.354-12.359-12.354-32.394 0-44.748 12.354-12.359 32.391-12.359 44.75 0l194.287 194.284c6.177 6.18 9.262 14.271 9.262 22.366 0 8.099-3.091 16.196-9.267 22.373z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BCP -->
                    <div class="col">
                        <div class="text-white rounded p-4 text-center m-1 h-100" style="background-color: #012D74;">
                            <p class="display-6">Pago con deposito a BCP:</p>
                            <img src="frontend/Resources/Images/pagos_icon/bcp.png" class="img-fluid">
                            <p>Realize el pago a nuestro numero de cuenta por el monto de <p><strong>S/. <span id="monto-bcp"></span></strong></p> Luego ingrese el numero de transaccion y procese el pago</p>
                            <div class="input-group">
                                <span class="input-group-text border-0"><i class="bi bi-wallet2"></i></span>
                                <input class="form-control border-0 input_field" placeholder="Número de transacción" type="text"
                                    name="nmr_process" id="nmr_process_bcp" required>
                            </div>
                            <div onclick="procesarPagoBcp()" id="container" class="m-auto border-0 mt-4 cont-btn">
                                <div class="left-side-bcp">
                                    <div id="card">
                                        <div class="card-line-bcp"></div>
                                        <div class="buttons"></div>
                                    </div>
                                    <div class="post">
                                        <div class="post-line"></div>
                                        <div class="screen">
                                            <div class="dollar">S/.</div>
                                        </div>
                                        <div class="numbers"></div>
                                        <div class="numbers-line2"></div>
                                    </div>
                                </div>
                                <div class="right-side">
                                    <div class="new border-0 text-black">Procesar</div>
                                    <svg viewBox="0 0 451.846 451.847" height="512" width="512" xmlns="http://www.w3.org/2000/svg"
                                        class="arrow">
                                        <path fill="#cfcfcf" data-old_color="#000000" class="active-path" data-original="#000000"
                                            d="M345.441 248.292L151.154 442.573c-12.359 12.365-32.397 12.365-44.75 0-12.354-12.354-12.354-32.391 0-44.744L278.318 225.92 106.409 54.017c-12.354-12.359-12.354-32.394 0-44.748 12.354-12.359 32.391-12.359 44.75 0l194.287 194.284c6.177 6.18 9.262 14.271 9.262 22.366 0 8.099-3.091 16.196-9.267 22.373z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de Garantía -->
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm border-0 rounded-4">
                    <div class="card-body p-4 text-center">
                        <div class="mb-3">
                            <i class="bi bi-shield-check text-success" style="font-size: 2.5rem;"></i>
                        </div>
                        <h4 class="mb-3">Pago Seguro Garantizado</h4>
                        <p class="text-muted mb-4">
                            Tu pago será procesado de manera segura y recibirás tu comprobante electrónico 
                            vía WhatsApp inmediatamente después de la confirmación.
                        </p>
                        <div class="d-flex justify-content-center gap-3">
                            <a href="frontend/Views/panelUser.html" class="btn btn-success px-4 py-2 rounded-pill">
                                <i class="bi bi-arrow-left me-2"></i>
                                Volver al Panel
                            </a>
                            <a href="#" onclick="abrirSoporte()" class="btn btn-outline-success px-4 py-2 rounded-pill">
                                <i class="bi bi-headset me-2"></i>
                                Soporte
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer mt-auto py-3 bg-dark text-white">
        <div class="container">
            <div class="row justify-content-center">
                
                <div class="col-md-4 d-flex flex-column align-items-center">
                    <h5 class="text-center">Síguenos:</h5>
                    <div class="social-icons">
                        <a href="https://www.facebook.com/HuanucoTelecomTV/?locale=es_LA" class="text-white"><i class="fab fa-facebook fa-2x"></i></a>                        

                    </div>
                </div>
                
            </div>
            <hr class="my-3">
            <div class="row text-center">
                <div class="col-12">
                    <p class="mb-1">¡Gracias por valorar nuestro trabajo!</p>
                    <p class="mb-0">Copyright ©2025 TELEINCA - OFICINA DE TECNOLOGÍAS DE LA INFORMACIÓN.</p>
                </div>
            </div>
        </div>
    </footer>
    <script>
        const codigoRecibo = localStorage.getItem('codigoRecibo');
        if (codigoRecibo) {
            console.log("Código del recibo: ", codigoRecibo);
        } else {
            console.log("No se encontró el código del recibo en localStorage");
        }

        const montoPago = localStorage.getItem('montoPago');
        if (montoPago) {
            console.log("Monto del pago: ", montoPago);
            document.getElementById('monto-yape').textContent = montoPago;
            document.getElementById('monto-bbva').textContent = montoPago;
            document.getElementById('monto-bcp').textContent = montoPago;
        } else {
            console.log("No se encontró el monto del pago en localStorage");
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Recuperar el código de usuario desde sessionStorage
            const codigoUsuario = sessionStorage.getItem('codigoUsuario');

            if (codigoUsuario) {
                // Mostrar el código en un elemento HTML con id 'codigoUsuario'
                const codigoUsuarioElemento = document.getElementById('codigoUsuario');
                if (codigoUsuarioElemento) {
                    codigoUsuarioElemento.textContent = codigoUsuario;
                }
                console.log("Código del usuario: ", codigoUsuario);
            } else {
                console.log("No se encontró el código de usuario.");
            }
        });        

        // Modificar la función enviarCorreo para obtener los valores
        async function enviarCorreo(metodoPago, numeroTransaccion) {
            // Obtener valores del sessionStorage
            const codigoRecibo = localStorage.getItem('codigoRecibo');
            const montoPago = localStorage.getItem('montoPago');
            const codigoUsuario = sessionStorage.getItem('codigoUsuario');
            const datosEnvio = {
                metodoPago,
                codigoRecibo,
                codigoUsuario,
                numeroTransaccion,
                montoPago
            };

            console.log('Enviando datos:', datosEnvio);

            try {
                const response = await fetch('http://201.230.101.89:11010/api/procesar-pago', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(datosEnvio)
                });
                
                const data = await response.json();
                console.log('Respuesta completa del servidor:', data);
                
                if (!data.success) {
                    console.error('Detalles del error del servidor:', data.error);
                    throw new Error(data.error?.message || data.message || 'Error desconocido');
                }
                
                return true;
            } catch (error) {
                console.error('Error completo:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error al enviar el correo',
                    text: error.message,
                    footer: 'Por favor, intente nuevamente o contacte al administrador'
                });
                return false;
            }
        }

        function procesarPagoYape() {
            const nmr_process = document.getElementById('nmr_process_yape').value;
            if (nmr_process == '') {
                Swal.fire({
                    icon: 'error',
                    title: '¡Ups!',
                    text: `Por favor, ingresa el número de transacción.`,
                    confirmButtonText: 'Aceptar'
                });
                return;
            }            
            enviarCorreo('YAPE', nmr_process)
                .then((success) => {
                    if (success) {
                        Swal.fire({
                            icon: 'success',
                            title: '¡Gracias por su pago!',
                            text: `
                            Tu solicitud de pago fue enviada a nuestra central de pagos
                            En las proximas 24 horas se retirara tu deuda del sistema
                            `,
                            confirmButtonText: 'Aceptar'
                        }).then(() => {
                            window.location.href = 'frontend/Views/panelUser.html';
                        });
                    }
                });
        }

        function procesarPagoBbva() {
            const nmr_process = document.getElementById('nmr_process_bbva').value;
            if (nmr_process == '') {
                Swal.fire({
                    icon: 'error',
                    title: '¡Ups!',
                    text: `Por favor, ingresa el número de transacción.`,
                    confirmButtonText: 'Aceptar'
                });
                return;
            }
            
            enviarCorreo('BBVA', nmr_process)
                .then((success) => {
                    if (success) {
                        Swal.fire({
                            icon: 'success',
                            title: '¡Gracias por su pago!',
                            text: `
                            Tu solicitud de pago fue enviada a nuestra central de pagos
                            En las proximas 24 horas se retirara tu deuda del sistema
                            `,
                            confirmButtonText: 'Aceptar'
                        }).then(() => {
                            window.location.href = 'frontend/Views/panelUser.html';
                        });
                    }
                });
        }

        function procesarPagoBcp() {
            const nmr_process = document.getElementById('nmr_process_bcp').value;
            if (nmr_process == '') {
                Swal.fire({
                    icon: 'error',
                    title: '¡Ups!',
                    text: `Por favor, ingresa el número de transacción.`,
                    confirmButtonText: 'Aceptar'
                });
                return;
            }
            
            enviarCorreo('BCP', nmr_process)
                .then((success) => {
                    if (success) {
                        Swal.fire({
                            icon: 'success',
                            title: '¡Gracias por su pago!',
                            text: `
                            Tu solicitud de pago fue enviada a nuestra central de pagos
                            En las proximas 24 horas se retirara tu deuda del sistema
                            `,
                            confirmButtonText: 'Aceptar'
                        }).then(() => {
                            window.location.href = 'frontend/Views/panelUser.html';
                        });
                    }
                });
        }

        function abrirSoporte() {
            const mensaje = `¡Hola! Necesito ayuda con mi pago`;
            window.open(`https://wa.me/+51962624690?text=${mensaje}`);
        }
    </script>
</body>

</html>